<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mock Subscription Tester</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .response-container {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .auth-warning {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1>Mock Subscription Tester</h1>
        <div class="alert alert-info">
            This page allows you to test the mock subscription system without using actual Stripe payments.
        </div>

        <!-- Authentication Status -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">Authentication Status</div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Status: <span id="auth-status">Not authenticated</span></label>
                        </div>
                        <div class="mb-3">
                            <label for="token-input" class="form-label">Auth Token:</label>
                            <input type="text" class="form-control" id="token-input" readonly>
                            <button class="btn btn-sm btn-secondary mt-2" id="copy-token-btn">Copy Token</button>
                        </div>
                        <div class="d-flex">
                            <button id="login-btn" class="btn btn-primary me-2">Login</button>
                            <button id="register-btn" class="btn btn-success me-2">Register</button>
                            <button id="logout-btn" class="btn btn-danger" disabled>Logout</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">Quick Auth</div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="quick-email" class="form-label">Email:</label>
                            <input type="email" class="form-control" id="quick-email">
                        </div>
                        <div class="mb-3">
                            <label for="quick-password" class="form-label">Password:</label>
                            <input type="password" class="form-control" id="quick-password">
                        </div>
                        <button id="quick-login-btn" class="btn btn-primary">Quick Login</button>
                        <button id="quick-register-btn" class="btn btn-success">Quick Register</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Subscription Testing -->
        <h3>Mock Subscription Operations</h3>
        <div class="row mb-4">
            <!-- Create Mock Subscription -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">Create Mock Subscription</div>
                    <div class="card-body">
                        <div class="auth-warning mb-3">Authentication required for this operation.</div>
                        <form id="create-subscription-form">
                            <div class="mb-3">
                                <label class="form-label">Subscription Plan:</label>
                                <select id="subscription-plan" class="form-select">
                                    <option value="premium">Premium</option>
                                    <option value="education">Education</option>
                                    <option value="yearly">Yearly Premium</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">Create Subscription</button>
                        </form>
                        <div class="response-container" id="create-subscription-response"></div>
                    </div>
                </div>
            </div>

            <!-- Cancel Mock Subscription -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">Cancel Mock Subscription</div>
                    <div class="card-body">
                        <div class="auth-warning mb-3">Authentication required for this operation.</div>
                        <button id="cancel-subscription-btn" class="btn btn-danger">Cancel Subscription</button>
                        <div class="response-container" id="cancel-subscription-response"></div>
                    </div>
                </div>
            </div>

            <!-- Get Subscription Details -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">Get Subscription Details</div>
                    <div class="card-body">
                        <div class="auth-warning mb-3">Authentication required for this operation.</div>
                        <button id="get-subscription-btn" class="btn btn-info">Get Subscription Details</button>
                        <div class="response-container" id="get-subscription-response"></div>
                    </div>
                </div>
            </div>

            <!-- Education Verification -->
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">Education Verification</div>
                    <div class="card-body">
                        <div class="auth-warning mb-3">Authentication required for this operation.</div>
                        <form id="verify-education-form">
                            <div class="mb-3">
                                <label for="student-email" class="form-label">Student Email (.edu):</label>
                                <input type="email" class="form-control" id="student-email" placeholder="example@university.edu">
                            </div>
                            <div class="mb-3">
                                <label for="year-of-study" class="form-label">Year of Study:</label>
                                <select id="year-of-study" class="form-select">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">Verify Education Status</button>
                        </form>
                        <div class="response-container" id="verify-education-response"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API base URL
        const API_BASE_URL = '/api';
        const MOCK_SUBSCRIPTION_URL = '/api/mock-subscription';

        // Authentication state
        let authToken = localStorage.getItem('authToken');
        let isAuthenticated = !!authToken;

        // DOM Elements
        const authStatusElement = document.getElementById('auth-status');
        const tokenInputElement = document.getElementById('token-input');
        const loginBtn = document.getElementById('login-btn');
        const registerBtn = document.getElementById('register-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const copyTokenBtn = document.getElementById('copy-token-btn');
        const authWarnings = document.querySelectorAll('.auth-warning');

        // Initialize auth status
        updateAuthStatus();

        // Event Listeners
        loginBtn.addEventListener('click', function() {
            alert('Please use the Quick Login form to login');
        });

        registerBtn.addEventListener('click', function() {
            alert('Please use the Quick Register form to register');
        });

        logoutBtn.addEventListener('click', function() {
            logout();
        });

        copyTokenBtn.addEventListener('click', function() {
            copyTokenToClipboard();
        });

        document.getElementById('quick-login-btn').addEventListener('click', function() {
            quickLogin();
        });

        document.getElementById('quick-register-btn').addEventListener('click', function() {
            quickRegister();
        });

        document.getElementById('create-subscription-form').addEventListener('submit', function(e) {
            e.preventDefault();
            createMockSubscription();
        });

        document.getElementById('cancel-subscription-btn').addEventListener('click', function() {
            cancelMockSubscription();
        });

        document.getElementById('get-subscription-btn').addEventListener('click', function() {
            getSubscriptionDetails();
        });

        document.getElementById('verify-education-form').addEventListener('submit', function(e) {
            e.preventDefault();
            verifyEducation();
        });

        // Authentication Functions
        function updateAuthStatus() {
            if (isAuthenticated) {
                authStatusElement.textContent = 'Authenticated';
                authStatusElement.style.color = 'green';
                tokenInputElement.value = authToken;
                loginBtn.disabled = true;
                registerBtn.disabled = true;
                logoutBtn.disabled = false;
                
                // Hide auth warnings
                authWarnings.forEach(warning => {
                    warning.style.display = 'none';
                });
            } else {
                authStatusElement.textContent = 'Not authenticated';
                authStatusElement.style.color = 'red';
                tokenInputElement.value = '';
                loginBtn.disabled = false;
                registerBtn.disabled = false;
                logoutBtn.disabled = true;
                
                // Show auth warnings
                authWarnings.forEach(warning => {
                    warning.style.display = 'block';
                });
            }
        }

        function setAuthToken(token) {
            authToken = token;
            isAuthenticated = !!token;
            if (token) {
                localStorage.setItem('authToken', token);
            } else {
                localStorage.removeItem('authToken');
            }
            updateAuthStatus();
        }

        function quickLogin() {
            const email = document.getElementById('quick-email').value;
            const password = document.getElementById('quick-password').value;
            
            if (!email || !password) {
                alert('Please enter email and password');
                return;
            }
            
            fetch(`${API_BASE_URL}/auth/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email, password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.token) {
                    setAuthToken(data.token);
                    alert('Login successful!');
                } else {
                    alert(`Login failed: ${data.message || 'Unknown error'}`);
                }
            })
            .catch(error => {
                alert(`Error: ${error.message}`);
            });
        }

        function quickRegister() {
            const email = document.getElementById('quick-email').value;
            const password = document.getElementById('quick-password').value;
            
            if (!email || !password) {
                alert('Please enter email and password');
                return;
            }
            
            fetch(`${API_BASE_URL}/auth/register`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ 
                    email, 
                    password,
                    name: email.split('@')[0] // Simple name generation
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.token) {
                    setAuthToken(data.token);
                    alert('Registration successful!');
                } else {
                    alert(`Registration failed: ${data.message || 'Unknown error'}`);
                }
            })
            .catch(error => {
                alert(`Error: ${error.message}`);
            });
        }

        function logout() {
            setAuthToken(null);
        }

        function copyTokenToClipboard() {
            tokenInputElement.select();
            document.execCommand('copy');
            alert('Token copied to clipboard!');
        }

        // Mock Subscription Functions
        function createMockSubscription() {
            if (!isAuthenticated) {
                alert('You need to be authenticated to use this endpoint.');
                return;
            }
            
            const plan = document.getElementById('subscription-plan').value;
            const responseElement = document.getElementById('create-subscription-response');
            
            responseElement.textContent = 'Sending request...';
            
            fetch(`${MOCK_SUBSCRIPTION_URL}/create`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify({ plan })
            })
            .then(response => response.json())
            .then(data => {
                responseElement.textContent = JSON.stringify(data, null, 2);
                if (data.success) {
                    alert(`Success: ${data.message}`);
                }
            })
            .catch(error => {
                responseElement.textContent = `Error: ${error.message}`;
            });
        }

        function cancelMockSubscription() {
            if (!isAuthenticated) {
                alert('You need to be authenticated to use this endpoint.');
                return;
            }
            
            const responseElement = document.getElementById('cancel-subscription-response');
            
            responseElement.textContent = 'Sending request...';
            
            fetch(`${MOCK_SUBSCRIPTION_URL}/cancel`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                responseElement.textContent = JSON.stringify(data, null, 2);
                if (data.success) {
                    alert(`Success: ${data.message}`);
                }
            })
            .catch(error => {
                responseElement.textContent = `Error: ${error.message}`;
            });
        }

        function getSubscriptionDetails() {
            if (!isAuthenticated) {
                alert('You need to be authenticated to use this endpoint.');
                return;
            }
            
            const responseElement = document.getElementById('get-subscription-response');
            
            responseElement.textContent = 'Sending request...';
            
            fetch(`${MOCK_SUBSCRIPTION_URL}/details`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                responseElement.textContent = JSON.stringify(data, null, 2);
            })
            .catch(error => {
                responseElement.textContent = `Error: ${error.message}`;
            });
        }

        function verifyEducation() {
            if (!isAuthenticated) {
                alert('You need to be authenticated to use this endpoint.');
                return;
            }
            
            const studentEmail = document.getElementById('student-email').value;
            const yearOfStudy = document.getElementById('year-of-study').value;
            const responseElement = document.getElementById('verify-education-response');
            
            if (!studentEmail || !studentEmail.includes('.edu')) {
                alert('Please enter a valid student email with .edu domain');
                return;
            }
            
            responseElement.textContent = 'Sending request...';
            
            fetch(`${MOCK_SUBSCRIPTION_URL}/verify-education`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify({ studentEmail, yearOfStudy })
            })
            .then(response => response.json())
            .then(data => {
                responseElement.textContent = JSON.stringify(data, null, 2);
                if (data.success) {
                    alert(`Success: ${data.message}`);
                }
            })
            .catch(error => {
                responseElement.textContent = `Error: ${error.message}`;
            });
        }
    </script>
</body>
</html> 