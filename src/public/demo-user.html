<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text the Answer - Demo User</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .response-container {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .feature-card {
            height: 100%;
            transition: transform 0.3s;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Text the Answer - Demo User</h1>
            <a href="index.html" class="btn btn-outline-secondary">Back to API Tester</a>
        </div>
        
        <div class="alert alert-info">
            <h4 class="alert-heading">Demo User Access</h4>
            <p>This page allows you to access a demo user account with premium features already enabled. 
            Use this to test all premium and education tier features without going through the subscription process.</p>
            <hr>
            <p class="mb-0">The demo user has both Premium and Education tier access enabled.</p>
        </div>

        <!-- Demo User Section -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0">Demo User Account</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div id="demo-user-info">
                            <p>Click the button below to create or access a demo user account:</p>
                            <button id="get-demo-user-btn" class="btn btn-primary mb-3">Get Demo User Access</button>
                            
                            <div id="demo-user-details" class="d-none">
                                <h5>Demo User Credentials:</h5>
                                <table class="table table-bordered">
                                    <tr>
                                        <th>Name:</th>
                                        <td id="demo-user-name"></td>
                                    </tr>
                                    <tr>
                                        <th>Email:</th>
                                        <td id="demo-user-email"></td>
                                    </tr>
                                    <tr>
                                        <th>Password:</th>
                                        <td id="demo-user-password"></td>
                                    </tr>
                                    <tr>
                                        <th>Status:</th>
                                        <td>
                                            <span class="badge bg-success">Premium</span>
                                            <span class="badge bg-info">Education</span>
                                        </td>
                                    </tr>
                                </table>
                                
                                <div class="mt-3">
                                    <h5>Auth Token:</h5>
                                    <div class="input-group mb-3">
                                        <input type="text" class="form-control" id="demo-token" readonly>
                                        <button class="btn btn-outline-secondary" type="button" id="copy-token-btn">Copy</button>
                                    </div>
                                    <div class="mb-3">
                                        <button id="auto-login-btn" class="btn btn-success">Auto-Login with Demo User</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="response-container" id="demo-user-response">No response yet</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Second Demo User for Multiplayer Testing -->
        <div class="card mb-4">
            <div class="card-header bg-secondary text-white">
                <h3 class="mb-0">Second Demo User (For Multiplayer Testing)</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div id="second-demo-user-info">
                            <p>Get a second demo user account to test multiplayer features:</p>
                            <button id="get-second-demo-user-btn" class="btn btn-secondary mb-3">Get Second Demo User</button>
                            
                            <div id="second-demo-user-details" class="d-none">
                                <h5>Second Demo User Credentials:</h5>
                                <table class="table table-bordered">
                                    <tr>
                                        <th>Name:</th>
                                        <td id="second-demo-user-name"></td>
                                    </tr>
                                    <tr>
                                        <th>Email:</th>
                                        <td id="second-demo-user-email"></td>
                                    </tr>
                                    <tr>
                                        <th>Password:</th>
                                        <td id="second-demo-user-password"></td>
                                    </tr>
                                    <tr>
                                        <th>Status:</th>
                                        <td>
                                            <span class="badge bg-success">Premium</span>
                                        </td>
                                    </tr>
                                </table>
                                
                                <div class="mt-3">
                                    <h5>Auth Token:</h5>
                                    <div class="input-group mb-3">
                                        <input type="text" class="form-control" id="second-demo-token" readonly>
                                        <button class="btn btn-outline-secondary" type="button" id="copy-second-token-btn">Copy</button>
                                    </div>
                                    <div class="mb-3">
                                        <button id="save-second-token-btn" class="btn btn-secondary">Save Second User Token</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="response-container" id="second-demo-user-response">No response yet</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Multiplayer Testing Instructions -->
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h3 class="mb-0">How to Test Multiplayer Features</h3>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <h5>Testing Lobby Creation and Joining</h5>
                    <p>Follow these steps to test the multiplayer lobby features:</p>
                </div>
                
                <ol>
                    <li class="mb-2">
                        <strong>Access with Main Demo User:</strong>
                        <ul>
                            <li>Click "Get Demo User Access"</li>
                            <li>Click "Auto-Login with Demo User"</li>
                        </ul>
                    </li>
                    <li class="mb-2">
                        <strong>Create a Lobby:</strong>
                        <ul>
                            <li>Go to the Game tab in the API Tester</li>
                            <li>Fill in lobby details and click "Create Lobby"</li>
                            <li>Note down the lobby code</li>
                        </ul>
                    </li>
                    <li class="mb-2">
                        <strong>Open a New Browser Window/Tab:</strong>
                        <ul>
                            <li>Open this page in a new browser window</li>
                            <li>Click "Get Second Demo User"</li>
                            <li>Click "Save Second User Token"</li>
                            <li>Open the API Tester in this new window</li>
                        </ul>
                    </li>
                    <li class="mb-2">
                        <strong>Join the Lobby with Second User:</strong>
                        <ul>
                            <li>Go to the Game tab</li>
                            <li>Use "Join Private Lobby" with the code from step 2</li>
                            <li>Or refresh and join via "Join Public Lobby"</li>
                        </ul>
                    </li>
                    <li class="mb-2">
                        <strong>Start and Play Game:</strong>
                        <ul>
                            <li>With the first user (lobby host), click "Start Game"</li>
                            <li>Both users can now participate in the game</li>
                        </ul>
                    </li>
                </ol>
                
                <div class="alert alert-secondary mt-3">
                    <p class="mb-0"><strong>Tip:</strong> You can use private/incognito browsing to easily manage multiple user sessions.</p>
                </div>
            </div>
        </div>

        <!-- Feature Cards -->
        <h3 class="mb-3">Premium Features to Test</h3>
        <div class="row mb-4">
            <div class="col-md-4 mb-3">
                <div class="card feature-card">
                    <div class="card-header bg-warning">
                        <h5 class="mb-0">Study Materials</h5>
                    </div>
                    <div class="card-body">
                        <p>Access to upload and generate questions from study materials. Premium users can upload more content and generate more questions.</p>
                        <a href="index.html#study" class="btn btn-outline-warning">Test Study Features</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card feature-card">
                    <div class="card-header bg-info">
                        <h5 class="mb-0">Multiplayer Games</h5>
                    </div>
                    <div class="card-body">
                        <p>Create and join multiplayer quiz games. Premium users can create more game lobbies and access special game modes.</p>
                        <a href="index.html#game" class="btn btn-outline-info">Test Game Features</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card feature-card">
                    <div class="card-header bg-success">
                        <h5 class="mb-0">Daily Quiz</h5>
                    </div>
                    <div class="card-body">
                        <p>Access to daily quiz questions with enhanced features for premium users, including more questions and detailed explanations.</p>
                        <a href="index.html#quiz" class="btn btn-outline-success">Test Quiz Features</a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Education Features -->
        <h3 class="mb-3">Education Tier Features</h3>
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="card feature-card">
                    <div class="card-header bg-primary">
                        <h5 class="mb-0">Study Groups</h5>
                    </div>
                    <div class="card-body">
                        <p>Education tier users can create study groups, share materials, and collaborate on question sets.</p>
                        <button class="btn btn-outline-primary disabled">Coming Soon</button>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="card feature-card">
                    <div class="card-header bg-secondary">
                        <h5 class="mb-0">Enhanced Analytics</h5>
                    </div>
                    <div class="card-body">
                        <p>Education tier users get detailed analytics about their performance, learning patterns, and improvement areas.</p>
                        <button class="btn btn-outline-secondary disabled">Coming Soon</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API base URL
        const API_BASE_URL = '/api';
        
        // DOM Elements
        const getDemoUserBtn = document.getElementById('get-demo-user-btn');
        const demoUserDetails = document.getElementById('demo-user-details');
        const demoUserName = document.getElementById('demo-user-name');
        const demoUserEmail = document.getElementById('demo-user-email');
        const demoUserPassword = document.getElementById('demo-user-password');
        const demoToken = document.getElementById('demo-token');
        const copyTokenBtn = document.getElementById('copy-token-btn');
        const autoLoginBtn = document.getElementById('auto-login-btn');
        const demoUserResponse = document.getElementById('demo-user-response');
        const getSecondDemoUserBtn = document.getElementById('get-second-demo-user-btn');
        const secondDemoUserDetails = document.getElementById('second-demo-user-details');
        const secondDemoUserName = document.getElementById('second-demo-user-name');
        const secondDemoUserEmail = document.getElementById('second-demo-user-email');
        const secondDemoUserPassword = document.getElementById('second-demo-user-password');
        const secondDemoToken = document.getElementById('second-demo-token');
        const copySecondTokenBtn = document.getElementById('copy-second-token-btn');
        const saveSecondTokenBtn = document.getElementById('save-second-token-btn');
        const secondDemoUserResponse = document.getElementById('second-demo-user-response');
        
        // Event Listeners
        getDemoUserBtn.addEventListener('click', getDemoUser);
        copyTokenBtn.addEventListener('click', copyToken);
        autoLoginBtn.addEventListener('click', autoLogin);
        getSecondDemoUserBtn.addEventListener('click', getSecondDemoUser);
        copySecondTokenBtn.addEventListener('click', copySecondToken);
        saveSecondTokenBtn.addEventListener('click', saveSecondToken);
        
        // Get Demo User
        async function getDemoUser() {
            try {
                demoUserResponse.textContent = 'Loading demo user...';
                
                const response = await fetch(`${API_BASE_URL}/demo/user`);
                const data = await response.json();
                
                demoUserResponse.textContent = JSON.stringify(data, null, 2);
                
                if (data.success) {
                    // Show demo user details
                    demoUserDetails.classList.remove('d-none');
                    
                    // Fill in user details
                    demoUserName.textContent = data.demoUser.name;
                    demoUserEmail.textContent = data.demoUser.email;
                    demoUserPassword.textContent = data.demoUser.password;
                    demoToken.value = data.token;
                    
                    // Store token in localStorage for auto-login
                    localStorage.setItem('demoUserToken', data.token);
                }
            } catch (error) {
                demoUserResponse.textContent = `Error: ${error.message}`;
            }
        }
        
        // Copy token to clipboard
        function copyToken() {
            demoToken.select();
            document.execCommand('copy');
            alert('Token copied to clipboard!');
        }
        
        // Auto login with demo user
        function autoLogin() {
            // Store the token for API tester page
            localStorage.setItem('authToken', demoToken.value);
            alert('Demo user token saved. You will be logged in on the API tester page.');
            
            // Redirect to API tester
            window.location.href = 'index.html';
        }
        
        // Check if we already have a demo user token
        document.addEventListener('DOMContentLoaded', function() {
            const savedToken = localStorage.getItem('demoUserToken');
            if (savedToken) {
                demoUserDetails.classList.remove('d-none');
                demoToken.value = savedToken;
                
                // Try to get user details
                fetch(`${API_BASE_URL}/auth/profile`, {
                    headers: {
                        'Authorization': `Bearer ${savedToken}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.user) {
                        demoUserName.textContent = data.user.name;
                        demoUserEmail.textContent = data.user.email;
                        demoUserPassword.textContent = 'demo123';
                    } else {
                        // Token might be expired, remove it
                        localStorage.removeItem('demoUserToken');
                    }
                })
                .catch(error => {
                    console.error('Error fetching profile:', error);
                    localStorage.removeItem('demoUserToken');
                });
            }
            
            // Check for second demo user token
            const savedSecondToken = localStorage.getItem('secondDemoUserToken');
            if (savedSecondToken) {
                secondDemoUserDetails.classList.remove('d-none');
                secondDemoToken.value = savedSecondToken;
                
                // Try to get user details
                fetch(`${API_BASE_URL}/auth/profile`, {
                    headers: {
                        'Authorization': `Bearer ${savedSecondToken}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.user) {
                        secondDemoUserName.textContent = data.user.name;
                        secondDemoUserEmail.textContent = data.user.email;
                        secondDemoUserPassword.textContent = 'demo123';
                    } else {
                        // Token might be expired, remove it
                        localStorage.removeItem('secondDemoUserToken');
                    }
                })
                .catch(error => {
                    console.error('Error fetching second profile:', error);
                    localStorage.removeItem('secondDemoUserToken');
                });
            }
        });

        // Get Second Demo User
        async function getSecondDemoUser() {
            try {
                secondDemoUserResponse.textContent = 'Loading second demo user...';
                
                const response = await fetch(`${API_BASE_URL}/demo/user2`);
                const data = await response.json();
                
                secondDemoUserResponse.textContent = JSON.stringify(data, null, 2);
                
                if (data.success) {
                    // Show second demo user details
                    secondDemoUserDetails.classList.remove('d-none');
                    
                    // Fill in user details
                    secondDemoUserName.textContent = data.demoUser.name;
                    secondDemoUserEmail.textContent = data.demoUser.email;
                    secondDemoUserPassword.textContent = data.demoUser.password;
                    secondDemoToken.value = data.token;
                    
                    // Store token in localStorage for auto-login
                    localStorage.setItem('secondDemoUserToken', data.token);
                }
            } catch (error) {
                secondDemoUserResponse.textContent = `Error: ${error.message}`;
            }
        }
        
        // Copy second token to clipboard
        function copySecondToken() {
            secondDemoToken.select();
            document.execCommand('copy');
            alert('Second demo user token copied to clipboard!');
        }
        
        // Save second token
        function saveSecondToken() {
            // Store the token for API tester page
            localStorage.setItem('authToken', secondDemoToken.value);
            alert('Second demo user token saved. You will be logged in on the API tester page.');
            
            // Redirect to API tester
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>